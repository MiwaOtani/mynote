<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>暗記アプリMyNote</title>
    <!-- CSS -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- fontawesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>

<body>
    <div class="outerWrapper">

        <!-- ヘッダーをインクルード -->
        <header id="header" class="">
            <nav>
                <ul>
                    <li><a class="nav" th:href="@{/mynote}"><i class="fa-solid fa-house-chimney"></i></a></li>
                    <li><a class="nav" th:href="@{/mynote/admin}"><i class="fa-solid fa-gear"></i></a></li>
            </nav>
            <h1>myNote<i class="fa-solid fa-pencil"></i></h1>
        </header>

        <main id="main" class="contents">
            <!-- ここにメインコンテンツ -->
			<section class="history-area">
				<h2>いままで勉強した履歴</h2>
				<!--Flashメッセージの表示-->
				<p th:if="${message}" th:text="${message}" style="color: blue;">完了メッセージ</p>
				<p th:if="${errorMessage}" th:text="${errorMessage}" style="color: red;">エラーメッセージ</p>
				
				<div class="rate-all frame">
					<h3>全体の正解率</h3>
					<!--	未回答を外して集計${correctRate}-->
					<p><span th:text="${#numbers.formatDecimal(correctRate, 1, 1)}">70</span>%</p>
					<div class="rate-bar-container">
						<div class="rate-bar" th:attr="data-rate=${correctRate}" th:inline="text"></div>
					</div>
				</div>
				
				<div class="word-a-day frame">
					<h3>今日のひとこと</h3>
					<p th:text="${dailyMessage}">猫と暮らす</p>
				</div>	
				
				<div class="rate-cate frame">
					<h3>カテゴリ別正解率</h3>
					<!-- カテゴリ別の集計 -->
					<div class="rate-bar-container" th:each="category : ${categories}" th:if="${category != null}">
						<p>
					      <span th:text="${category.categoryName}">カテゴリ名</span>：
					      <span th:text="${#numbers.formatDecimal(categoryCorrectRates[category.categoryId], 1, 1)}">0.0</span>%
					    </p>
						<div class="rate-bar" th:attr="data-rate=${categoryCorrectRates[category.categoryId]}" th:inline="text"></div>
					</div>
				</div>

				<!-- 問題一覧と正誤表 -->
						<h3> Your History<i class="fa-solid fa-clock-rotate-left"></i></h3>
						<table class="history-list">
						  <tr>
						    <th width="80%"><span>あなたが登録した問題一覧</span></th>
						    <th width="20%"><span>回答履歴</span></th>
<!--							<th>表示</th>-->
<!--							<th>切替</th>-->
						  </tr>
						  
						  <tr th:each="quiz : ${quizzes}">
						    <td>
								<a th:href="@{/mynote/quizzes/{id}(id=${quiz.id})}">
									<span th:text="${quiz.question}">問題とリンク</span>
								</a>
							</td>
							<td>
							  <span th:if="${quiz.history != null and quiz.history.answeredAt != null}"
							        th:text="${quiz.history.isCorrect ? '○' : '×'}">○</span>
							  <span th:if="${quiz.history == null or quiz.history.answeredAt == null}">未回答</span>
							</td>
<!--							<td th:text="${quiz.isVisible} ? '表示中' : '非表示'"></td>-->
<!--							<td>-->
<!--								<form th:action="@{'/mynote/quizzes/' + (${quiz.isVisible} ? 'hide' : 'show') + '/' + ${quiz.id}}" method="post">-->
<!--									<input type="hidden" name="redirectTo" th:value="@{/mynote/history}" />  redirectToを変える -->
<!--									<button type="submit" th:text="${quiz.isVisible} ? '非表示にする' : '表示に戻す'"></button>-->
<!--								</form>-->
<!--							</td>-->
						</tr>
						</table>
						
</section>
						
            <!-- //メインコンテンツここまで -->
        </main>

        <!-- フッターをインクルード -->
        <footer id="footer">
            <p>Copyright &copy; 2025 Anki Appli myNote.</p>
        </footer>
    </div><!--outerWrapper-->
	
<!--	<script src="/js/script.js"></script>-->
<!--	<script>-->
<!--	  document.addEventListener("DOMContentLoaded", function () {-->
<!--	    const bar = document.querySelector(".rate-bar");-->
<!--	    const rate = parseFloat(bar.getAttribute("data-rate")); // 例: "70.0"-->
<!--	    bar.style.width = rate + "%"; // "70%"-->
<!--	  });-->
<!--	</script>-->
	<script>
	  document.addEventListener("DOMContentLoaded", function () {
	    document.querySelectorAll(".rate-bar").forEach(function (bar) {
	      const rate = bar.getAttribute("data-rate");
	      if (rate !== null) {
	        bar.style.width = rate + "%";
	      }
	    });
	  });
	</script>
</body>

</html>