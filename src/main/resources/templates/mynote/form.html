<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>暗記アプリMyNote</title>
    <!-- CSS -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- fontawesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>

<body>
    <div class="outerWrapper">

        <!-- ヘッダーをインクルード -->
        <header id="header" class="">
            <nav>
                <ul>
                    <li><a class="nav" th:href="@{/mynote}"><i class="fa-solid fa-house-chimney"></i></a></li>
                    <li><a class="nav" th:href="@{/mynote/admin}"><i class="fa-solid fa-gear"></i></a></li>
            </nav>
            <h1>myNote<i class="fa-solid fa-pencil"></i></h1>
        </header>

        <main id="main" class="contents">
            <!-- ここにメインコンテンツ -->
			<section class="edit-form">
<!-- タイトル：登録 OR 編集 -->
<h2 th:if="${myNoteForm.isNew}">新しい問題を作成する</h2>
<h2 th:unless="${myNoteForm.isNew}">登録した問題を編集する</h2>
<!-- アクション：登録 OR 編集 -->
<form th:action="${myNoteForm.isNew} ? @{/mynote/quizzes/save} : @{/mynote/quizzes/update}" th:object="${myNoteForm}" method="post" enctype="multipart/form-data">
<!-- idは更新時に必要なため、hiddenで持つ-->
<input type="hidden" th:field="*{id}">

	<h3>問題文 <i class="fa-solid fa-pen-to-square"></i><small>※必須項目です。</small></h3>
    <textarea class="question-txt" th:field="*{question}"></textarea>
	<!--バリデーションエラー表示 -->
	<span th:if="${#fields.hasErrors('question')}" th:errors="*{question}" style="color:red;">エラーがあれば表示</span>
    <div class="image-area">
		<label for="imageInput">画像 <i class="fa-solid fa-image"></i></label>
	 	<input type="file" name="image" accept="image/*" id="imageInput"><br>
		<div id="paste-zone"><span>直接貼り付けもできます</span><br>
		<img id="preview" style="max-width:300px; display:none;"><br></div>
	</div>

	<h3>カテゴリ<i class="fa-solid fa-layer-group"></i></h3>
	<label for="categoryId">選んでください</label>
	<select id="categoryId" th:field="*{categoryId}">
	    <option value="" disabled selected>選んでください</option>
	    <option th:each="cat : ${categories}" th:value="${cat.categoryId}" th:text="${cat.categoryName}"></option>
<!--		<option th:each="cat : ${categories}"-->
<!--		        th:value="${cat != null ? cat.categoryId : 0}"-->
<!--		        th:text="${cat != null ? cat.categoryName : '未設定'}">-->
<!--		</option>-->

	</select>
	

	
<h3>問題形式 <i class="fa-solid fa-truck-pickup"></i><br><small>※回答2件は必須です。正解にチェックをしてください。</small></h3>
  <label>
    <input type="radio" th:field="*{questionType}" name="questionType" value="multiple" />
    選択肢形式
  </label>
  <label>
    <input type="radio" th:field="*{questionType}" name="questionType" value="truefalse" />
    ○×形式
  </label>
  
  
  <div class="answer-row" id="answer1Block">
    <label class="answer-label" data-index="1" for="answer1"></label>
    <textarea id="answer1" th:field="*{answer1}"></textarea>
    <label>
      <input type="radio" name="correctAns" value="1" th:checked="${myNoteForm.correctAns == 1}" />
      正解
    </label>
  </div>
  <!--バリデーションエラー表示 -->
  <span th:if="${#fields.hasErrors('answer1')}" th:errors="*{answer1}" style="color:red;">エラーがあれば表示</span>

  <div class="answer-row" id="answer2Block" >
    <label class="answer-label" data-index="2" for="answer2"></label>
    <textarea id="answer2" th:field="*{answer2}"></textarea>
    <label>
      <input type="radio" name="correctAns" value="2" th:checked="${myNoteForm.correctAns == 2}" />
      正解
    </label>
  </div>
  <!--バリデーションエラー表示 -->
  <span th:if="${#fields.hasErrors('answer2')}" th:errors="*{answer2}" style="color:red;">エラーがあれば表示</span>

  <!-- answer3・answer4は表示制御あり -->
  <div class="answer-row" id="answer3Block" style="display:none;">
    <label class="answer-label" data-index="3" for="answer3"></label>
    <textarea id="answer3" th:field="*{answer3}"></textarea>
    <label>
      <input type="radio" name="correctAns" value="3" th:checked="${myNoteForm.correctAns == 3}" />
      正解
    </label>
  </div>

  <div class="answer-row" id="answer4Block" style="display:none;">
    <label class="answer-label" data-index="4" for="answer4"></label>
    <textarea id="answer4" th:field="*{answer4}"></textarea>
    <label>
      <input type="radio" name="correctAns" value="4" th:checked="${myNoteForm.correctAns == 4}" />
      正解
    </label>
  </div>
  
  
<!-- ボタン：登録 OR 編集 -->
<div class="btn-area nav-btn">
<!--<input th:if="${myNoteForm.isNew}" type="submit" value="これで登録する">-->
<!--<input th:unless="${myNoteForm.isNew}" type="submit" value="これで更新する">-->
<!-- 送信ボタンを通常のsubmitから確認用ボタンに変更 -->
<input type="button" value="これで登録する" onclick="handleConfirm()" th:if="${myNoteForm.isNew}">
<input type="button" value="これで更新する" onclick="handleConfirm()" th:unless="${myNoteForm.isNew}" >
</div>
<!-- フォームクリアボタン -->
<div class="nav-btn">
<input type="button" value="フォームをクリアしてやり直す" onclick="window.location.href='/mynote/quizzes/form';">
</div>
</div>

</form>
<!--<a th:href="@{/mynote}">トップページへ戻る</a>-->

<div id="confirmPopup" class="popup nav-btn hidden">
  <h3>登録内容の確認</h3>
  <div id="confirmContent">
    <!-- JavaScriptで埋める -->
  </div>
  <img id="confirmImage" style="max-width: 100%; display: none; margin-top: 10px;">
  <button type="button" onclick="submitForm()">はい、登録する</button>
  <button type="button" onclick="cancelPopup()">キャンセル</button>
</div>

</section>
            <!-- //メインコンテンツここまで -->
        </main>

        <!-- フッターをインクルード -->
        <footer id="footer">
            <p>Copyright &copy; 2025 Anki Appli myNote.</p>
        </footer>
    </div><!--outerWrapper-->
	
	<script src="/js/script.js"></script>
	<script src="/js/popup.js"></script>
</body>

</html>